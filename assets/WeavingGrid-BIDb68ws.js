import{_ as J,r as u,m as rt,w as I,n as ct,p as dt,c as F,a as e,q as C,v as M,t as w,b as N,F as ut,u as vt,x as z,y as pt,o as A,z as ft,A as mt,B as R,C as E,D as gt,E as bt,W as ht}from"./index-B5G6K9od.js";const xt={class:"editor-container"},_t={class:"controls-panel"},yt={class:"controls-content"},wt={class:"dimensions-section"},kt={class:"dimension-inputs"},Ct={class:"dimension-label"},$t={class:"dimension-value"},Bt={class:"dimension-label"},Ft={class:"dimension-value"},At={class:"dimension-label"},Pt={class:"dimension-value"},St={class:"color-section"},Ut={class:"color-picker-container"},Mt={class:"color-value"},Rt={class:"recent-colors-header mt-3!"},Et={class:"recent-colors-grid"},Tt=["title","onClick"],Dt=["onClick"],Gt={class:"tools-section"},Ot={class:"tools-grid"},Vt={class:"export-section"},Lt={class:"grid-container"},Wt={class:"image-section"},It={class:"upload-section"},Nt={class:"upload-label mb-2!"},zt={class:"upload-label"},Jt={key:0,class:"image-preview"},jt=["src"],qt={class:"canvas-wrapper"},Ht={class:"canvas-header"},Xt={class:"text-xs text-gray-500"},Yt={class:"canvas-container"},Kt={class:"canvas-info"},Qt={class:"mb-2 flex items-center gap-2"},Zt={class:"flex items-center gap-2 text-sm"},te={__name:"WeavingGridEditor",emits:["update-grid"],setup(j){const o=u(40),i=u(120),c=u(10),f=u(!0),k=u("paint"),m=u(["#8B2D2B","#D36B43","#E9C76A","#172B4A","#FFFFFF"][3]),g=u([]),P=u(null),y=u(null);let b=null;const h=rt({data:[]});function _(){h.data=Array.from({length:i.value},()=>Array.from({length:o.value},()=>null))}const v=u([]);function G(n){v.value.push(n),v.value.length>50&&v.value.shift()}function q(){const n=v.value.pop();n&&(h.data=n,B())}function O(){const n=window.devicePixelRatio||1,t=(o.value+(f.value?.5:0))*c.value,s=i.value*c.value,l=y.value;l.width=Math.round(t*n),l.height=Math.round(s*n),l.style.width=`${Math.round(t)}px`,l.style.height=`${Math.round(s)}px`,b.setTransform(n,0,0,n,0,0)}function H(n,t,s,l){const d=s*.18;b.fillStyle=l||"#f3f4f6",b.beginPath(),X(b,n,t,s,s,d),b.fill(),b.lineWidth=Math.max(.6,s*.06),b.strokeStyle="rgba(0,0,0,0.06)",b.stroke()}function X(n,t,s,l,d,r){n.beginPath(),n.moveTo(t+r,s),n.arcTo(t+l,s,t+l,s+d,r),n.arcTo(t+l,s+d,t,s+d,r),n.arcTo(t,s+d,t,s,r),n.arcTo(t,s,t+l,s,r),n.closePath()}function B(){if(!b)return;b.clearRect(0,0,y.value.width,y.value.height);const n=c.value;for(let t=0;t<i.value;t++)for(let s=0;s<o.value;s++){const l=f.value&&t%2===1?n/2:0,d=s*n+l,r=t*n,a=h.data[t]&&h.data[t][s];H(d,r,n,a)}}function Y(n,t){const s=y.value.getBoundingClientRect(),l=n-s.left,d=t-s.top,r=c.value,a=Math.floor(d/r),x=f.value&&a%2===1?r/2:0,p=Math.floor((l-x)/r);return a<0||a>=i.value||p<0||p>=o.value?null:{r:a,c:p}}let T=!1;function K(n){n.preventDefault(),y.value.setPointerCapture(n.pointerId),T=!0,G(JSON.parse(JSON.stringify(h.data))),L(n)}function Q(n){T&&L(n)}function V(n){T=!1;try{y.value.releasePointerCapture(n.pointerId)}catch{}}function L(n){const t=Y(n.clientX,n.clientY);if(!t)return;const{r:s,c:l}=t;h.data[s][l]=m.value==="#FFFFFF"?null:m.value,tt(m.value),B()}function W(n){k.value=n}function Z(){G(JSON.parse(JSON.stringify(h.data))),_(),B()}function tt(n){const t=g.value.indexOf(n);t>-1&&g.value.splice(t,1),g.value.unshift(n),g.value.length>10&&(g.value=g.value.slice(0,10))}function et(n){const t=g.value.indexOf(n);t>-1&&g.value.splice(t,1)}function st(){g.value=[]}function nt(){const n=document.createElement("canvas"),t=n.getContext("2d"),s=c.value,l=20,d=o.value*s+l*2,r=i.value*s+l*2;n.width=d,n.height=r,t.fillStyle="#ffffff",t.fillRect(0,0,d,r);for(let a=0;a<i.value;a++)for(let x=0;x<o.value;x++){const p=h.data[a]&&h.data[a][x];if(p){t.fillStyle=p;const S=f.value&&a%2===1?s/2:0,D=l+x*s+S,it=l+a*s;t.fillRect(D,it,s,s)}}n.toBlob(a=>{const x=URL.createObjectURL(a),p=document.createElement("a");p.href=x,p.download=`weaving_grid_${o.value}x${i.value}_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.png`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(x)},"image/png")}function lt(){return h.data}function ot(n){const t=n.target.files[0];if(t){const s=new FileReader;s.onload=l=>{try{const d=l.target.result.trim(),r=JSON.parse(d);if(Array.isArray(r)&&r.every(a=>typeof a=="string"&&a.match(/^#[0-9A-Fa-f]{6}$/))){const a=[];for(let x=0;x<i.value;x++){const p=[];for(let S=0;S<o.value;S++){const D=x*o.value+S;p.push(r[D]||null)}a.push(p)}h.data=a,B()}}catch(d){console.error("Error parsing text file:",d)}},s.readAsText(t)}}function at(n){const t=n.target.files[0];t&&(P.value=URL.createObjectURL(t))}I([o,i],()=>{_(),U()}),I([c,f],()=>{U()});function U(){requestAnimationFrame(()=>{O(),B()})}return ct(()=>{b=y.value.getContext("2d"),_(),O(),B(),window.addEventListener("resize",U)}),dt(()=>{window.removeEventListener("resize",U)}),(n,t)=>(A(),F("div",xt,[e("div",_t,[t[16]||(t[16]=e("div",{class:"controls-header"},[e("h3",{class:"mb-4 text-lg font-bold text-gray-800"},"🎨 ابزارهای طراحی")],-1)),e("div",yt,[e("div",wt,[t[11]||(t[11]=e("h4",{class:"mb-2 text-sm font-semibold text-gray-700"}," 📐 ابعاد شبکه ",-1)),e("div",kt,[e("label",Ct,[t[8]||(t[8]=e("span",{class:"dimension-text"},"ستون‌ها (عرض):",-1)),C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value=s),type:"range",min:"8",max:"160",class:"dimension-range"},null,512),[[M,o.value,void 0,{number:!0}]]),e("span",$t,w(o.value),1)]),e("label",Bt,[t[9]||(t[9]=e("span",{class:"dimension-text"},"ردیف‌ها (طول):",-1)),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.value=s),type:"range",min:"8",max:"400",class:"dimension-range"},null,512),[[M,i.value,void 0,{number:!0}]]),e("span",Ft,w(i.value),1)]),e("label",At,[t[10]||(t[10]=e("span",{class:"dimension-text"},"اندازه مهره:",-1)),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>c.value=s),type:"range",min:"6",max:"28",class:"dimension-range"},null,512),[[M,c.value,void 0,{number:!0}]]),e("span",Pt,w(c.value)+"px",1)])])]),e("div",St,[t[13]||(t[13]=e("h4",{class:"mb-2 text-sm font-semibold text-gray-700"}," 🎨 انتخاب رنگ ",-1)),e("div",Ut,[C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>m.value=s),type:"color",class:"color-picker"},null,512),[[M,m.value]]),e("span",Mt,w(m.value),1)]),e("div",Rt,[t[12]||(t[12]=e("h4",{class:"text-sm font-semibold text-gray-700"},"🔄 رنگ‌های اخیر",-1)),g.value.length>0?(A(),F("button",{key:0,class:"clear-colors-btn",title:"پاک کردن تمام رنگ‌ها",onClick:st}," 🗑️ پاک کردن ")):N("",!0)]),e("div",Et,[(A(!0),F(ut,null,vt(g.value,s=>(A(),F("div",{key:s,class:"color-swatch",style:ft({backgroundColor:s}),title:s,onClick:l=>m.value=s},[e("button",{class:"remove-color-btn",onClick:mt(l=>et(s),["stop"])}," × ",8,Dt)],12,Tt))),128))])]),e("div",Gt,[t[14]||(t[14]=e("h4",{class:"mb-2 text-sm font-semibold text-gray-700"},"🛠️ ابزارها",-1)),e("div",Ot,[e("button",{class:z(["tool-btn primary",{active:k.value==="paint"}]),onClick:t[4]||(t[4]=s=>W("paint"))}," 🖌️ Paint ",2),e("button",{class:z(["tool-btn primary",{active:k.value==="fill"}]),onClick:t[5]||(t[5]=s=>W("fill"))}," 🪣 Fill ",2),e("button",{class:"tool-btn secondary",onClick:q}," ↩️ Undo "),e("button",{class:"tool-btn secondary",onClick:Z}," 🗑️ Clear All ")])]),e("div",Vt,[t[15]||(t[15]=e("h4",{class:"mb-2 text-sm font-semibold text-gray-700"},"📤 خروجی",-1)),e("button",{class:"export-btn primary",onClick:t[6]||(t[6]=s=>n.$emit("update-grid",lt()))}," 🚀 ارسال به 3D "),e("button",{class:"export-btn success",onClick:nt}," 📷 خروجی عکس ")])])]),e("div",Lt,[e("div",Wt,[e("div",It,[e("label",Nt,[t[17]||(t[17]=e("span",{class:"upload-text"},"📁 آپلود فایل txt grid",-1)),e("input",{type:"file",accept:".txt",class:"upload-input",onChange:ot},null,32)]),e("label",zt,[t[18]||(t[18]=e("span",{class:"upload-text"},"📁 آپلود تصویر",-1)),e("input",{type:"file",accept:"image/*",class:"upload-input",onChange:at},null,32)])]),P.value?(A(),F("div",Jt,[e("img",{src:P.value,alt:"تصویر انتخاب شده",class:"preview-image"},null,8,jt)])):N("",!0)]),e("div",qt,[e("div",Ht,[t[19]||(t[19]=e("div",{class:"text-sm font-medium"},"نمایش عمودی (90° چرخش فرض شده)",-1)),e("div",Xt," | ستون‌ها: "+w(o.value)+" × ردیف‌ها: "+w(i.value),1)]),e("div",Yt,[e("canvas",{ref_key:"canvas",ref:y,class:"mx-auto block",onPointerdown:K,onPointermove:Q,onPointerup:V,onPointerleave:V},null,544)]),e("div",Kt,[e("div",Qt,[e("label",Zt,[C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>f.value=s),type:"checkbox"},null,512),[[pt,f.value]]),t[20]||(t[20]=e("span",null,"حالت اجرچینی (Brick)",-1))])]),t[21]||(t[21]=e("div",{class:"text-xs text-gray-600"},' نکته: "حالت اجرچینی" هر ردیف زوج یا فرد را نیم مهره جابه‌جا می‌کند تا ظاهر بافت Brick Stitch شبیه‌سازی شود. ',-1))])])])]))}},ee=J(te,[["__scopeId","data-v-134c6be0"]]),se={class:"home-container"},ne={class:"app-header flex items-start justify-between mb-3!"},le={class:"stats-section"},oe={class:"stat-item"},ae={class:"stat-number"},ie={class:"stat-item"},re={class:"stat-number"},ce={class:"stat-item"},de={class:"stat-number"},ue={class:"stat-item"},ve={class:"stat-number"},pe={class:"content-container"},fe={__name:"WeavingGrid",setup(j){const o=u(16),i=u(80),c=u(Array(16*80).fill("#ffffff")),f=u(!0),k=u(!1),$=u(!1),m=u(!1);function g(){f.value=!0,k.value=!1,$.value=!1,m.value=!1}function P(){k.value=!0,f.value=!1,$.value=!1,m.value=!1}function y(){$.value=!0,k.value=!1,f.value=!1,m.value=!1}function b(){m.value=!0,f.value=!1,k.value=!1,$.value=!1}function h(_){if(!Array.isArray(_)||_.length===0){c.value=[],o.value=0,i.value=0;return}o.value=_.length,i.value=Array.isArray(_[0])?_[0].length:0,c.value=_.flat()}return(_,v)=>(A(),F("div",se,[e("header",ne,[e("div",{class:"header-content"},[v[0]||(v[0]=e("div",{class:"logo-section"},[e("h1",{class:"app-title text-2xl"},"🎨 Miyuki Beads Designer - Flat Style")],-1)),e("div",{class:"header-actions mt-3! flex items-center gap-2"},[e("button",{class:"rounded-md bg-cyan-950 px-4! py-2! text-[18px] text-white",onClick:g}," ویرایشگر شبکه "),e("button",{class:"rounded-md bg-blue-900 px-4! py-2! text-[18px] text-white",onClick:P}," نمایش مهره‌ها "),e("button",{class:"rounded-md bg-emerald-900 px-4! py-2! text-[18px] text-white",onClick:y}," پیش‌نمایش دستبند "),e("button",{class:"rounded-md bg-emerald-900 px-4! py-2! text-[18px] text-white",onClick:b}," مراحل اجرا ")])]),e("div",le,[e("div",oe,[e("div",ae,w(o.value),1),v[1]||(v[1]=e("div",{class:"stat-label"},"ردیف",-1))]),e("div",ie,[e("div",re,w(i.value),1),v[2]||(v[2]=e("div",{class:"stat-label"},"ستون",-1))]),e("div",ce,[e("div",de,w(c.value.length),1),v[3]||(v[3]=e("div",{class:"stat-label"},"مهره",-1))]),e("div",ue,[e("div",ve,w((c.value.length/190).toFixed(2)),1),v[4]||(v[4]=e("div",{class:"stat-label"},"گرم",-1))])])]),e("div",pe,[C(E(ee,{class:"content-component",onUpdateGrid:h},null,512),[[R,f.value]]),C(E(gt,{pattern:c.value,rows:o.value,cols:i.value,class:"content-component"},null,8,["pattern","rows","cols"]),[[R,k.value]]),C(E(bt,{pattern:c.value,rows:o.value,cols:i.value,class:"content-component"},null,8,["pattern","rows","cols"]),[[R,$.value]]),C(E(ht,{pattern:c.value,rows:o.value,cols:i.value,class:"content-component"},null,8,["pattern","rows","cols"]),[[R,m.value]])])]))}},ge=J(fe,[["__scopeId","data-v-8729f0a8"]]);export{ge as default};

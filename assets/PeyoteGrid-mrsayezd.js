import{G as te}from"./PeyoteGridEditor-DWReSn1X.js";import{r as b,n as L,S as N,J as E,P as $,K as S,O as H,L as W,M as z,w as V,p as q,c as O,o as _,N as I,Q as T,R as D,_ as F,a as t,T as se,t as x,H as M,b as B,W as ae}from"./index-BDGAK8mJ.js";const ne={__name:"MiyukiBeads",props:{pattern:{type:Array,required:!0},rows:{type:Number,default:10},cols:{type:Number,default:50}},setup(y){const d=y,e=b(null);let l,n,s,o,c=[];function h(){const u=new I(.7,.7,1.1,32),m=(d.cols-1)/2,g=(d.rows-1)/2;for(let p=0;p<d.rows;p++)for(let i=0;i<d.cols;i++){const a=p*d.cols+i,r=d.pattern[a]||"#ffffff",k=new T({color:r,roughness:.1,metalness:.1,clearcoat:.5,clearcoatRoughness:.1}),A=new D(u,k),P=i%2===1?.6:0;A.position.set((i-m)*1.2,-(p-g)*1.2-P,0),l.add(A),c.push(A)}}return L(()=>{l=new N,l.background=new E(15790320),n=new $(45,e.value.clientWidth/e.value.clientHeight,.1,1e3),n.position.set(50,-50,50),s=new S({antialias:!0}),s.setPixelRatio(Math.min(window.devicePixelRatio||1,2));function u(){if(!e.value)return;const i=e.value.clientWidth,a=e.value.clientHeight;i===0||a===0||(n.aspect=i/a,n.updateProjectionMatrix(),s.setSize(i,a,!1))}u(),e.value.appendChild(s.domElement);const m=new ResizeObserver(()=>{u()});m.observe(e.value),s.__resizeObserver=m,o=new H(n,s.domElement),l.add(new W(16777215,.5));const g=new z(16777215,3);g.position.set(10,10,10),l.add(g),h();function p(){requestAnimationFrame(p),o.update(),s.render(l,n)}p(),window.addEventListener("resize",u),s.__resizeHandler=u}),V(()=>d.pattern,()=>{c.forEach(u=>l.remove(u)),c=[],h()},{deep:!0}),q(()=>{s&&s.__resizeHandler&&window.removeEventListener("resize",s.__resizeHandler),s&&s.__resizeObserver&&e.value&&s.__resizeObserver.disconnect(),o&&o.dispose(),s&&s.dispose(),c=[]}),(u,m)=>(_(),O("div",{ref_key:"container",ref:e,class:"bead-container"},null,512))}},oe={class:"bracelet-wrapper"},re={class:"canvas-container"},ie={class:"toolbar"},le={class:"info-panel"},ce={class:"info-item"},de={class:"info-value"},fe={class:"info-item"},ue={class:"info-value"},pe={__name:"BraceletPreview",props:{pattern:{type:Array,required:!0},rows:{type:Number,required:!0},cols:{type:Number,required:!0},width:{type:Number,default:900},height:{type:Number,default:600}},setup(y,{expose:d}){const e=y,l=b(null);let n,s,o,c,h=[];function u(){h.forEach(a=>n.remove(a)),h=[]}function m(){if(!n)return;u(),console.log("BraceletPreview - props:",{pattern:e.pattern,rows:e.rows,cols:e.cols,patternLength:e.pattern?e.pattern.length:0,patternType:Array.isArray(e.pattern)?"Array":typeof e.pattern}),e.pattern&&Array.isArray(e.pattern)&&console.log("Pattern structure:",{firstRow:e.pattern[0],firstRowLength:e.pattern[0]?e.pattern[0].length:0,firstRowType:e.pattern[0]?typeof e.pattern[0]:"undefined",sampleValues:e.pattern.slice(0,3).map(f=>f?f.slice(0,3):"undefined")});const a=20,r=Math.PI*1.55,k=-r/2;new E("#b58a3a");const A=r/e.rows,G=a*A*.98,P=.95,U=1,Y=new I(P*.7,P*.7,G,16);for(let f=0;f<e.rows;f++)for(let v=0;v<e.cols;v++){let w="#ffffff";if(Array.isArray(e.pattern[0]))w=e.pattern[f]&&e.pattern[f][v]?e.pattern[f][v]:"#ffffff";else{const ee=f*e.cols+v;w=e.pattern[ee]||"#ffffff"}f===0&&v===0&&console.log("First bead debug:",{y:f,x:v,patternY:e.pattern[f],patternYX:e.pattern[f]?e.pattern[f][v]:void 0,colorHex:w,patternType:Array.isArray(e.pattern[0])?"Matrix":"Simple Array",index:f*e.cols+v}),(!w||w==="#"||w.length<3)&&(w="#ffffff",console.warn("Invalid color detected:",w,"using default white"));const j=new E(w),X=new T({color:j,roughness:.25,metalness:.15,clearcoat:.4,clearcoatRoughness:.1}),J=v%2===1?.5:0,R=k+(f+.5+J)*A,K=(e.cols/2-.5-v)*U,Q=a*Math.sin(R),Z=a*Math.cos(R),C=new D(Y,X);C.position.set(Q,K,Z),C.rotation.z=Math.PI/2,C.rotation.y=R,n.add(C),h.push(C)}}function g(){n=new N,n.background=new E(15987699),s=new $(42,e.width/e.height,.1,2e3),s.position.set(0,3,95),s.lookAt(0,0,0),o=new S({antialias:!0,preserveDrawingBuffer:!0}),o.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),o.setSize(e.width,e.height,!1),l.value.appendChild(o.domElement),n.add(new W(16777215,.7));const a=new z(16777215,1.1);a.position.set(8,10,12),n.add(a);const r=new z(16777215,.6);r.position.set(-8,-3,8),n.add(r),c=new H(s,o.domElement),c.enableDamping=!0,c.target.set(0,0,0);function k(){requestAnimationFrame(k),c.update(),o.render(n,s)}k()}function p(){o&&(c.update(),o.render(n,s))}function i(){p();const a=o.domElement.toDataURL("image/png"),r=document.createElement("a");r.href=a,r.download="bracelet.png",r.click()}return L(()=>{g(),m(),p()}),V(()=>[e.pattern,e.rows,e.cols],()=>{m(),p()},{deep:!0}),q(()=>{c&&c.dispose(),o&&o.dispose(),h=[]}),d({downloadImage:i}),(a,r)=>(_(),O("div",oe,[r[4]||(r[4]=t("div",{class:"header"},[t("h2",{class:"title"},"پیش‌نمایش دستبند"),t("p",{class:"subtitle"},"نمایش سه‌بعدی طرح انتخاب شده")],-1)),t("div",re,[t("div",{ref_key:"container",ref:l,class:"bracelet-canvas"},null,512),r[0]||(r[0]=se('<div class="canvas-overlay" data-v-472f7258><div class="controls-hint" data-v-472f7258><div class="hint-item" data-v-472f7258><span class="hint-icon" data-v-472f7258>🖱️</span><span data-v-472f7258>برای چرخاندن کلیک و درگ کنید</span></div><div class="hint-item" data-v-472f7258><span class="hint-icon" data-v-472f7258>🔍</span><span data-v-472f7258>برای زوم اسکرول کنید</span></div></div></div>',1))]),t("div",ie,[t("button",{class:"btn btn-primary",onClick:i},r[1]||(r[1]=[t("span",{class:"btn-icon"},"📥",-1),t("span",null,"دانلود تصویر",-1)])),t("div",le,[t("div",ce,[r[2]||(r[2]=t("span",{class:"info-label"},"ابعاد:",-1)),t("span",de,x(y.cols)+" × "+x(y.rows),1)]),t("div",fe,[r[3]||(r[3]=t("span",{class:"info-label"},"تعداد مهره:",-1)),t("span",ue,x(y.cols*y.rows),1)])])])]))}},ve=F(pe,[["__scopeId","data-v-472f7258"]]),me={class:"home-container"},he={class:"app-header flex items-start justify-between mb-3!"},we={class:"stats-section"},be={class:"stat-item"},ye={class:"stat-number"},ge={class:"stat-item"},_e={class:"stat-number"},xe={class:"stat-item"},ke={class:"stat-number"},Ae={class:"stat-item"},Ce={class:"stat-number"},Pe={class:"content-container"},Me={__name:"PeyoteGrid",setup(y){const d=b(16),e=b(80),l=b(Array(16*80).fill("#ffffff")),n=b(!0),s=b(!1),o=b(!1),c=b(!1);function h(){n.value=!0,s.value=!1,o.value=!1,c.value=!1}function u(){s.value=!0,n.value=!1,o.value=!1,c.value=!1}function m(){o.value=!0,s.value=!1,n.value=!1,c.value=!1}function g(){c.value=!0,n.value=!1,s.value=!1,o.value=!1}function p(i){if(!Array.isArray(i)||i.length===0){l.value=[],d.value=0,e.value=0;return}d.value=i.length,e.value=Array.isArray(i[0])?i[0].length:0,l.value=i.flat()}return(i,a)=>(_(),O("div",me,[t("header",he,[t("div",{class:"header-content"},[t("div",{class:"header-actions mt-3! flex items-center gap-2"},[t("button",{class:"rounded-md bg-cyan-950 px-4! py-1! text-[14px] text-white",onClick:h}," ویرایشگر شبکه "),t("button",{class:"rounded-md bg-blue-900 px-4! py-1! text-[14px] text-white",onClick:u}," نمایش مهره‌ها "),t("button",{class:"rounded-md bg-emerald-900 px-4! py-1! text-[14px] text-white",onClick:m}," پیش‌نمایش دستبند "),t("button",{class:"rounded-md bg-emerald-900 px-4! py-1! text-[14px] text-white",onClick:g}," مراحل اجرا ")])]),t("div",we,[t("div",be,[t("div",ye,x(d.value),1),a[0]||(a[0]=t("div",{class:"stat-label"},"ردیف",-1))]),t("div",ge,[t("div",_e,x(e.value),1),a[1]||(a[1]=t("div",{class:"stat-label"},"ستون",-1))]),t("div",xe,[t("div",ke,x(l.value.length),1),a[2]||(a[2]=t("div",{class:"stat-label"},"مهره",-1))]),t("div",Ae,[t("div",Ce,x((l.value.length/190).toFixed(2)),1),a[3]||(a[3]=t("div",{class:"stat-label"},"گرم",-1))])])]),t("div",Pe,[n.value?(_(),M(te,{key:0,class:"content-component",onUpdateGrid:p})):B("",!0),s.value?(_(),M(ne,{key:1,pattern:l.value,rows:d.value,cols:e.value,class:"content-component"},null,8,["pattern","rows","cols"])):B("",!0),o.value?(_(),M(ve,{key:2,pattern:l.value,rows:d.value,cols:e.value,class:"content-component"},null,8,["pattern","rows","cols"])):B("",!0),c.value?(_(),M(ae,{key:3,pattern:l.value,rows:d.value,cols:e.value,class:"content-component"},null,8,["pattern","rows","cols"])):B("",!0)])]))}},ze=F(Me,[["__scopeId","data-v-77c15418"]]);export{ze as default};
